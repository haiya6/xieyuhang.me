---
container: Post
title: 为什么模糊查询会很慢？
date: 2023/4/20
---

[[toc]]

近期在开发后台管理系统中，碰到了很多需要根据关键字来模糊查询记录的需求，在数据量很大的时候，会看到后端同学提示模糊查询会很慢的情况，本篇文章将基于 MySQL 数据库来分析为什么会存在这种情况。

> 文章不涉及到代码，理论知识为主

## MySQL 存储数据格式预览

数据库即是我们一个业务系统中存储数据的地方，例如一个 txt 文件、一个 excel 文件都能做到存储数据，但在开发中，会选用"专业的"的工具来存储，如 MySQL 数据库，通过可视化工具可以预览一张数据表大概长这样

![table](/imgs/sfq/table.png)

像一个 Excel 表一样，有表头信息：
  + id（商品ID）
  + goods_title（商品的标题）
  + goods_sub_title（商品的副标题）
  + goods_url（商品的主图）
  + goods_price（商品的价格）
  
还有一些数据（随机生成的500万条），表的名称为 my_goods

假设下列场景，需要找到所有商品价格为 1300.1 的商品（随机选择的一个值），执行 `select * from my_goods where goods_price = 1300.1;`

![result1](/imgs/sfq/result1.png)

执行该查询花费了 1.22s ，查询过程很简单，从第一条开始，一直找到最后一条数据，期间如果遇到了商品价格是 1300.1 的商品，则记录下来，500万条数据都访问完成之后，返回那些符合条件的数据

可以想象到，这种查询的效率是非常低的，当然也不符合这样的"专业工具"的能力，在 MySQL 中，有一个概念称为"索引"，即是为了提升查询速度的存在，接下来看一下索引的相关知识

## 索引、BTREE

事实上，my_goods 表在建表时，已经存在了一个针对 ID 字段建立的索引，通过下面这个需求可以体验到索引带来的速度查询提升：

找到商品 ID 是 4890000（随机选择的一个值）的商品： `select * from my_goods where id = 4890000;`

![result2](/imgs/sfq/result2.png)

可以看到查询时间小于 0.000s，速度有了不小的提升，那么是怎么实现的呢

TODO

## 模糊查询导致索引失效

TODO

## 针对模糊查询的优化

TODO
